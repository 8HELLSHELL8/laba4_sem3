{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Outlet,Link,useNavigate}from'react-router-dom';import axios from'axios';import'../css/Layout.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function getCookie(name){const cookieValue=document.cookie.match('(^|;)\\\\s*'+name+'\\\\s*=\\\\s*([^;]+)');return cookieValue?cookieValue.pop():'';}axios.interceptors.request.use(config=>{console.log('Request Headers:',config.headers);console.log('Cookies being sent:',document.cookie);return config;},error=>{console.error('Request error:',error);return Promise.reject(error);});axios.interceptors.response.use(response=>{console.log('Response Headers:',response.headers);console.log('Response Data:',response.data);return response;},error=>{var _error$response;console.error('Response error:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);return Promise.reject(error);});const Layout=()=>{const[currentUser,setCurrentUser]=useState(undefined);const[loading,setLoading]=useState(true);const fetchCurrentUser=async()=>{setLoading(true);try{const csrfToken=getCookie('_csrfToken');if(!csrfToken){console.error(\"CSRF token not found during user fetch.\");setCurrentUser(null);return;}const response=await axios.get('http://localhost:5000/api/protected',{withCredentials:true,headers:{'x-csrf-token':csrfToken}});const userData=response.data.user?{...response.data.user,name:response.data.user.name||'User'}:null;setCurrentUser(userData);}catch(error){if(error.response&&(error.response.status===401||error.response.status===403)){setCurrentUser(null);}else{console.error('Error fetching current user:',error);setCurrentUser(null);}}finally{setLoading(false);}};const handleLogout=async()=>{try{const csrfToken=getCookie('_csrfToken');if(!csrfToken){alert(\"CSRF token not found. Please refresh the page or try logging in again.\");return;}await axios.post('http://localhost:5000/api/logout',{},{withCredentials:true,headers:{'x-csrf-token':csrfToken}});window.location.href='/auth';}catch(error){console.error('Error during logout:',error);alert('Произошла ошибка при выходе из системы на сервере. Перенаправление на страницу входа.');window.location.href='/auth';}};useEffect(()=>{fetchCurrentUser();},[]);if(loading||currentUser===undefined){return/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'},children:/*#__PURE__*/_jsx(\"p\",{children:\"Loading profile info...\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"layout-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-left\",children:/*#__PURE__*/_jsx(Link,{to:currentUser?\"/home\":\"/auth\",className:\"logo-link\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"logo\",children:\"Security system control menu\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"header-right\",children:currentUser?/*#__PURE__*/_jsx(\"div\",{className:\"user-info\",children:/*#__PURE__*/_jsxs(Link,{to:\"/profile\",className:\"user-name-link\",children:[\"Welcome, \",(currentUser===null||currentUser===void 0?void 0:currentUser.name)||'User']})}):/*#__PURE__*/_jsx(Link,{to:\"/auth\",className:\"login-link\",children:\"\\u0412\\u0445\\u043E\\u0434\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-content-wrapper\",children:[currentUser&&/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"nav\",{className:\"nav-menu\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(Link,{to:\"/home\",className:\"nav-link\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-home\"}),\" Main page\"]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(Link,{to:\"/profile\",className:\"nav-link\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user\"}),\" Profile\"]})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"sidebar-logout-section\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:handleLogout,className:\"sidebar-logout-button nav-link\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-out-alt\"}),\" Logout\"]})})]}),/*#__PURE__*/_jsx(\"main\",{className:`content-area ${!currentUser?'full-width':''}`,children:/*#__PURE__*/_jsx(Outlet,{context:{currentUser,setCurrentUser,fetchCurrentUser}})})]})]});};export default Layout;","map":{"version":3,"names":["React","useState","useEffect","Outlet","Link","useNavigate","axios","jsx","_jsx","jsxs","_jsxs","getCookie","name","cookieValue","document","cookie","match","pop","interceptors","request","use","config","console","log","headers","error","Promise","reject","response","data","_error$response","message","Layout","currentUser","setCurrentUser","undefined","loading","setLoading","fetchCurrentUser","csrfToken","get","withCredentials","userData","user","status","handleLogout","alert","post","window","location","href","className","style","display","justifyContent","alignItems","height","children","to","onClick","context"],"sources":["/home/anton/laba4/frontend/src/components/Layout.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Outlet, Link, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport '../css/Layout.css';\n\nfunction getCookie(name) {\n    const cookieValue = document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]+)');\n    return cookieValue ? cookieValue.pop() : '';\n}\n\naxios.interceptors.request.use((config) => {\n  console.log('Request Headers:', config.headers);\n  console.log('Cookies being sent:', document.cookie);\n  return config;\n}, (error) => {\n  console.error('Request error:', error);\n  return Promise.reject(error);\n});\n\naxios.interceptors.response.use((response) => {\n  console.log('Response Headers:', response.headers);\n  console.log('Response Data:', response.data);\n  return response;\n}, (error) => {\n  console.error('Response error:', error.response?.data || error.message);\n  return Promise.reject(error);\n});\n\nconst Layout = () => {\n  const [currentUser, setCurrentUser] = useState(undefined);\n  const [loading, setLoading] = useState(true);\n\n  const fetchCurrentUser = async () => {\n    setLoading(true);\n    try {\n      const csrfToken = getCookie('_csrfToken');\n      if (!csrfToken) {\n        console.error(\"CSRF token not found during user fetch.\");\n        setCurrentUser(null);\n        return;\n      }\n\n      const response = await axios.get('http://localhost:5000/api/protected', {\n        withCredentials: true,\n        headers: {\n          'x-csrf-token': csrfToken, \n        },\n      });\n\n      const userData = response.data.user ? {\n        ...response.data.user,\n        name: response.data.user.name || 'User'\n      } : null;\n\n      setCurrentUser(userData);\n    } catch (error) {\n      if (error.response && (error.response.status === 401 || error.response.status === 403)) {\n        setCurrentUser(null);\n      } else {\n        console.error('Error fetching current user:', error);\n        setCurrentUser(null);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      const csrfToken = getCookie('_csrfToken');\n      if (!csrfToken) {\n        alert(\"CSRF token not found. Please refresh the page or try logging in again.\");\n        return;\n      }\n\n      await axios.post('http://localhost:5000/api/logout', {}, {\n        withCredentials: true,\n        headers: {\n          'x-csrf-token': csrfToken, \n        },\n      });\n      window.location.href = '/auth';\n    } catch (error) {\n      console.error('Error during logout:', error);\n      alert('Произошла ошибка при выходе из системы на сервере. Перенаправление на страницу входа.');\n      window.location.href = '/auth';\n    }\n  };\n\n  useEffect(() => {\n    fetchCurrentUser();\n  }, []);\n\n  if (loading || currentUser === undefined) {\n    return (\n      <div className=\"loading-container\" style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>\n        <p>Loading profile info...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"layout-container\">\n      <header className=\"header\">\n        <div className=\"header-left\">\n          <Link to={currentUser ? \"/home\" : \"/auth\"} className=\"logo-link\">\n            <h1 className=\"logo\">Security system control menu</h1>\n          </Link>\n        </div>\n        <div className=\"header-right\">\n          {currentUser ? (\n            <div className=\"user-info\">\n              <Link to=\"/profile\" className=\"user-name-link\">\n                Welcome, {currentUser?.name || 'User'}\n              </Link>\n            </div>\n          ) : (\n            <Link to=\"/auth\" className=\"login-link\">\n              Вход\n            </Link>\n          )}\n        </div>\n      </header>\n\n      <div className=\"main-content-wrapper\">\n        {currentUser && (\n          <aside className=\"sidebar\">\n            <nav className=\"nav-menu\">\n              <ul>\n                <li>\n                  <Link to=\"/home\" className=\"nav-link\">\n                    <i className=\"fas fa-home\"></i> Main page\n                  </Link>\n                </li>\n                <li>\n                  <Link to=\"/profile\" className=\"nav-link\">\n                    <i className=\"fas fa-user\"></i> Profile\n                  </Link>\n                </li>\n              </ul>\n            </nav>\n            <div className=\"sidebar-logout-section\">\n              <button onClick={handleLogout} className=\"sidebar-logout-button nav-link\">\n                <i className=\"fas fa-sign-out-alt\"></i> Logout\n              </button>\n            </div>\n          </aside>\n        )}\n        <main className={`content-area ${!currentUser ? 'full-width' : ''}`}>\n          <Outlet context={{ currentUser, setCurrentUser, fetchCurrentUser }} />\n        </main>\n      </div>\n    </div>\n  );\n};\n\nexport default Layout;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}