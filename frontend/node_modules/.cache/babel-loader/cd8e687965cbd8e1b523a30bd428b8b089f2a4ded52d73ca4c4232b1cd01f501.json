{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Link,useNavigate}from\"react-router-dom\";import axios from\"axios\";import\"../css/Home.css\";// Helper function to get a cookie by name\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function getCookie(name){const cookieValue=document.cookie.match('(^|;)\\\\s*'+name+'\\\\s*=\\\\s*([^;]+)');return cookieValue?cookieValue.pop():'';}axios.interceptors.request.use(config=>{console.log('Request Headers:',config.headers);console.log('Cookies being sent:',document.cookie);return config;},error=>{console.error('Request error:',error);return Promise.reject(error);});axios.interceptors.response.use(response=>{console.log('Response Headers:',response.headers);console.log('Response Data:',response.data);return response;},error=>{var _error$response;console.error('Response error:',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);return Promise.reject(error);});const Home=()=>{const[data,setData]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(\"\");const navigate=useNavigate();useEffect(()=>{const loadData=async()=>{setLoading(true);setError(\"\");try{// Получаем CSRF-токен из cookies\nconst csrfToken=getCookie('_csrfToken');if(!csrfToken){setError(\"CSRF token not found. Please refresh the page or try logging in again.\");return;}const response=await axios.get(\"http://server:5000/api/items\",{withCredentials:true,headers:{'x-csrf-token':csrfToken// Добавляем CSRF-токен в заголовки\n}});setData(response.data);}catch(err){if(err.response&&err.response.status===401){setError(\"Your session may have expired. Please log out and log back in.\");}else if(err.response&&err.response.status===403){setError(\"CSRF validation failed. Please refresh the page or try logging in again.\");}else if(err.response){setError(err.response.data.message||\"An error occurred while loading data.\");}else if(err.request){setError(\"No response from the server. Please try again later.\");}else{setError(\"An unexpected error occurred.\");}console.error(\"Error loading data:\",err);}finally{setLoading(false);}};loadData();},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"home-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"home-header\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"home-title\",children:\"Device List\"}),/*#__PURE__*/_jsx(Link,{to:\"/add\",className:\"add-device-button\",children:\"Add Device\"})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading devices...\"})]}):error?/*#__PURE__*/_jsx(\"div\",{className:\"error-state\",children:/*#__PURE__*/_jsx(\"p\",{children:error})}):data.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"empty-state\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No devices found.\"})}):/*#__PURE__*/_jsx(\"div\",{className:\"device-list\",children:data.map(item=>/*#__PURE__*/_jsxs(Link,{to:`/detail/${item.id}`,className:\"device-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"device-icon\",children:/*#__PURE__*/_jsx(\"span\",{className:\"icon-circle\",children:\"\\u25CF\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"device-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:item.name}),/*#__PURE__*/_jsx(\"p\",{className:\"device-type\",children:item.type||'Unknown type'}),/*#__PURE__*/_jsx(\"p\",{className:\"device-status\",children:/*#__PURE__*/_jsx(\"span\",{className:`status-indicator ${item.status==='Active'?'active':'inactive'}`,children:item.status||'Inactive'})})]})]},item.id))})]});};export default Home;","map":{"version":3,"names":["React","useState","useEffect","Link","useNavigate","axios","jsx","_jsx","jsxs","_jsxs","getCookie","name","cookieValue","document","cookie","match","pop","interceptors","request","use","config","console","log","headers","error","Promise","reject","response","data","_error$response","message","Home","setData","loading","setLoading","setError","navigate","loadData","csrfToken","get","withCredentials","err","status","className","children","to","length","map","item","id","type"],"sources":["/home/anton/laba4/frontend/src/pages/Home.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport \"../css/Home.css\";\n\n// Helper function to get a cookie by name\nfunction getCookie(name) {\n    const cookieValue = document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]+)');\n    return cookieValue ? cookieValue.pop() : '';\n}\n\naxios.interceptors.request.use((config) => {\n  console.log('Request Headers:', config.headers);\n  console.log('Cookies being sent:', document.cookie);\n  return config;\n}, (error) => {\n  console.error('Request error:', error);\n  return Promise.reject(error);\n});\n\naxios.interceptors.response.use((response) => {\n  console.log('Response Headers:', response.headers);\n  console.log('Response Data:', response.data);\n  return response;\n}, (error) => {\n  console.error('Response error:', error.response?.data || error.message);\n  return Promise.reject(error);\n});\n\nconst Home = () => {\n  const [data, setData] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(\"\");\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const loadData = async () => {\n      setLoading(true);\n      setError(\"\");\n\n      try {\n        // Получаем CSRF-токен из cookies\n        const csrfToken = getCookie('_csrfToken');\n        if (!csrfToken) {\n          setError(\"CSRF token not found. Please refresh the page or try logging in again.\");\n          return;\n        }\n\n        const response = await axios.get(\"http://server:5000/api/items\", {\n          withCredentials: true,\n          headers: {\n            'x-csrf-token': csrfToken, // Добавляем CSRF-токен в заголовки\n          },\n        });\n        setData(response.data);\n      } catch (err) {\n        if (err.response && err.response.status === 401) {\n          setError(\"Your session may have expired. Please log out and log back in.\");\n        } else if (err.response && err.response.status === 403) {\n          setError(\"CSRF validation failed. Please refresh the page or try logging in again.\");\n        } else if (err.response) {\n          setError(err.response.data.message || \"An error occurred while loading data.\");\n        } else if (err.request) {\n          setError(\"No response from the server. Please try again later.\");\n        } else {\n          setError(\"An unexpected error occurred.\");\n        }\n        console.error(\"Error loading data:\", err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadData();\n  }, []);\n\n  return (\n    <div className=\"home-container\">\n      <div className=\"home-header\">\n        <h1 className=\"home-title\">Device List</h1>\n        <Link to=\"/add\" className=\"add-device-button\">\n          Add Device\n        </Link>\n      </div>\n\n      {loading ? (\n        <div className=\"loading-state\">\n          <div className=\"spinner\"></div>\n          <p>Loading devices...</p>\n        </div>\n      ) : error ? (\n        <div className=\"error-state\">\n          <p>{error}</p>\n        </div>\n      ) : data.length === 0 ? (\n        <div className=\"empty-state\">\n          <p>No devices found.</p>\n        </div>\n      ) : (\n        <div className=\"device-list\">\n          {data.map((item) => (\n            <Link\n              to={`/detail/${item.id}`}\n              className=\"device-card\"\n              key={item.id}\n            >\n              <div className=\"device-icon\">\n                <span className=\"icon-circle\">&#9679;</span>\n              </div>\n              <div className=\"device-info\">\n                <h3>{item.name}</h3>\n                <p className=\"device-type\">{item.type || 'Unknown type'}</p>\n                <p className=\"device-status\">\n                  <span\n                    className={`status-indicator ${\n                      item.status === 'Active' ? 'active' : 'inactive'\n                    }`}\n                  >\n                    {item.status || 'Inactive'}\n                  </span>\n                </p>\n              </div>\n            </Link>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Home;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}